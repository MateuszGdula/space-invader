!function(e){var t={};function s(i){if(t[i])return t[i].exports;var h=t[i]={i:i,l:!1,exports:{}};return e[i].call(h.exports,h,h.exports,s),h.l=!0,h.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var h in e)s.d(i,h,function(t){return e[t]}.bind(null,h));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=3)}([function(e,t,s){var i=s(1);"string"==typeof i&&(i=[[e.i,i,""]]);var h={insert:"head",singleton:!1};s(2)(i,h);i.locals&&(e.exports=i.locals)},function(e,t,s){},function(e,t,s){"use strict";var i,h={},n=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},a=function(){var e={};return function(t){if(void 0===e[t]){var s=document.querySelector(t);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(e){s=null}e[t]=s}return e[t]}}();function o(e,t){for(var s=[],i={},h=0;h<e.length;h++){var n=e[h],a=t.base?n[0]+t.base:n[0],o={css:n[1],media:n[2],sourceMap:n[3]};i[a]?i[a].parts.push(o):s.push(i[a]={id:a,parts:[o]})}return s}function r(e,t){for(var s=0;s<e.length;s++){var i=e[s],n=h[i.id],a=0;if(n){for(n.refs++;a<n.parts.length;a++)n.parts[a](i.parts[a]);for(;a<i.parts.length;a++)n.parts.push(w(i.parts[a],t))}else{for(var o=[];a<i.parts.length;a++)o.push(w(i.parts[a],t));h[i.id]={id:i.id,refs:1,parts:o}}}}function d(e){var t=document.createElement("style");if(void 0===e.attributes.nonce){var i=s.nc;i&&(e.attributes.nonce=i)}if(Object.keys(e.attributes).forEach((function(s){t.setAttribute(s,e.attributes[s])})),"function"==typeof e.insert)e.insert(t);else{var h=a(e.insert||"head");if(!h)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");h.appendChild(t)}return t}var l,c=(l=[],function(e,t){return l[e]=t,l.filter(Boolean).join("\n")});function p(e,t,s,i){var h=s?"":i.css;if(e.styleSheet)e.styleSheet.cssText=c(t,h);else{var n=document.createTextNode(h),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(n,a[t]):e.appendChild(n)}}function m(e,t,s){var i=s.css,h=s.media,n=s.sourceMap;if(h&&e.setAttribute("media",h),n&&btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(n))))," */")),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}var u=null,y=0;function w(e,t){var s,i,h;if(t.singleton){var n=y++;s=u||(u=d(t)),i=p.bind(null,s,n,!1),h=p.bind(null,s,n,!0)}else s=d(t),i=m.bind(null,s,t),h=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(s)};return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else h()}}e.exports=function(e,t){(t=t||{}).attributes="object"==typeof t.attributes?t.attributes:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=n());var s=o(e,t);return r(s,t),function(e){for(var i=[],n=0;n<s.length;n++){var a=s[n],d=h[a.id];d&&(d.refs--,i.push(d))}e&&r(o(e,t),t);for(var l=0;l<i.length;l++){var c=i[l];if(0===c.refs){for(var p=0;p<c.parts.length;p++)c.parts[p]();delete h[c.id]}}}}},function(t,s,i){"use strict";i.r(s);i(0);const h=()=>{const e=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),t=document.querySelector(".game");let s=e?Math.max(screen.width,screen.height):Math.min(innerWidth,innerHeight);return t.width=Math.round(1.77*s),t.height=s,{ctx:t.getContext("2d"),w:t.width,h:t.height-60,statusBarHeight:60,isMobile:e}},n=e=>({background:{asset:e.bg,speed:.5},playerShip:{asset:e.ship,speed:2,shield:100},alienShips:[{asset:e.alien1,speed:1.2,shield:100,weapon:{name:"Blaster WTF-30",asset:e.missleA1,w:.02,h:.01,damage:10,speedX:3,speedY:0,reloadTime:1e3},reward:100},{asset:e.alien2,speed:1,shield:200,weapon:{name:"Rocket Launcher WTF-30",asset:e.missleA2,w:.02,h:.02,damage:20,speedX:1.8,speedY:0,reloadTime:4e3},reward:300},{asset:e.alien3,speed:1.5,shield:40,weapon:{name:"Laser Blaster XYZ123",asset:e.missleA3,w:.06,h:.06,damage:5,speedX:4,speedY:0,reloadTime:4e3},reward:150}],shield:{asset:e.shield,speed:4,type:"shield"},weapon:{asset:e.weapon,speed:3,type:"weapon"}}),a=e=>[{name:"Blaster WTF-40",asset:e.missle1,w:.02,h:.01,damage:20,speedX:4,speedY:0,reloadTime:100,charges:"UNLIMITED"},{name:"Plasma Blaster BB1k",asset:e.missle2,w:.07,h:.07,damage:35,speedX:9,speedY:0,reloadTime:180,charges:100}];class o extends EventTarget{constructor(e,t,s,i){super(),this.setVars(e,t,s,i)}setVars(e,{asset:t,speed:s,shield:i,weapon:h,reward:n},a,o){this.ctx=e,this.asset=t,this.speedX=s-Math.random()/2,this.speedY=this.speedX/2,this.shield=i,this.w=.08*SI_GAME.data.w,this.h=.05*SI_GAME.data.h,this.x=SI_GAME.data.w,this.y=1+Math.floor(Math.random()*(SI_GAME.data.h-this.h)),this.target=a,this.isChaser=o,this.reload=!1,this.weapon=h,this.reward=n}draw(){this.ctx.beginPath(),this.ctx.drawImage(this.asset,this.x,this.y,this.w,this.h),this.ctx.closePath(),this.update()}update(){if(this.shield<=0&&this.shipExplosion(),this.x-=this.speedX,this.isChaser&&this.target.y+this.target.h/2>this.y+this.h/2?this.y+=this.speedY:this.isChaser&&this.target.y+this.target.h/2<this.y+this.h/2&&(this.y-=this.speedY),this.target.y<this.y+this.h/2&&this.target.y+this.target.h>this.y+this.h/2&&this.target.x+this.target.w<this.x&&this.shot(),this.x>SI_GAME.data.w||this.x+this.w<0||this.y>SI_GAME.data.h||this.y+this.h<0){let e=new Event("remove");this.dispatchEvent(e)}}shipExplosion(){const e=new Event("explosion"),t={};t.x=this.x,t.y=this.y,t.w=this.w,t.h=this.h,t.speedX=-1.3*this.speedX,t.speedY=0,t.time=30,e.explosionData=t,this.dispatchEvent(e)}shot(){if(this.reload)return;const e=new Event("shot"),t={};t.asset=this.weapon.asset,t.w=this.weapon.w,t.h=this.weapon.h,t.x=this.x,t.y=this.y+Math.round(this.h/2)-Math.round(this.weapon.h*SI_GAME.data.h/2),t.speedX=-1*this.weapon.speedX,t.speedY=this.weapon.speedY,t.dmg=this.weapon.damage,t.owner="npc",e.missleData=t,this.dispatchEvent(e),this.reload=!0,setTimeout(()=>this.reload=!1,this.weapon.reloadTime)}}var r=o;var d=class{constructor(e,{asset:t,speed:s}){this.ctx=e,this.asset=t,this.speed=s,this.x=0,this.w=SI_GAME.data.w,this.h=SI_GAME.data.h}draw(){this.ctx.beginPath(),this.ctx.drawImage(this.asset,this.x,0,this.w,this.h),this.ctx.drawImage(this.asset,this.x+SI_GAME.data.w,0,this.w,this.h),this.ctx.closePath(),this.x>-1*SI_GAME.data.w?this.x-=this.speed:this.x=0}};class l extends EventTarget{constructor(e,t){super(),this.setVars(e,t),this.createContent()}setVars(e,{asset:t,speed:s,type:i}){this.ctx=e,this.asset=t,this.speed=s,this.type=i,this.w=.04*SI_GAME.data.w,this.h=this.w,this.x=SI_GAME.data.w,this.y=1+Math.floor(Math.random()*(SI_GAME.data.h-this.h)),this.content={}}createContent(){if("shield"===this.type)this.content={shield:10+Math.round(30*Math.random())};else if("weapon"===this.type){let e=Math.floor(Math.random()*(SI_GAME.weapons.length-1))+1;this.content={weapon:SI_GAME.weapons[e]}}}draw(){this.ctx.beginPath(),this.ctx.drawImage(this.asset,this.x,this.y,this.w,this.h),this.ctx.closePath(),this.update()}update(){if(this.x-=this.speed,this.x+this.w<0){let e=new Event("remove");this.dispatchEvent(e)}}}var c=l;class p extends EventTarget{constructor(e,t){super(),this.setVars(e,t)}setVars(e,{x:t,y:s,w:i,h:h,speedX:n,speedY:a,time:o}){this.ctx=e,this.x=t,this.y=s,this.w=i,this.h=h,this.speedX=n,this.speedY=a,this.asset=SI_GAME.assets.explosion,this.framesCounter=o}draw(){this.ctx.beginPath(),this.ctx.drawImage(this.asset,this.x,this.y,this.w,this.h),this.ctx.closePath(),this.update()}update(){this.w*=1.015,this.h*=1.015,this.x+=this.speedX,this.y+=this.speedY,0===this.framesCounter?this.dispatchEvent(new Event("remove")):this.framesCounter--}}var m=p;var u=[{2:{type:"enemy",index:0,number:1,chaser:!0},7:{type:"enemy",index:0,number:2,chaser:!1},8:{type:"box",content:"weapon"},11:{type:"enemy",index:1,number:1,chaser:!0},12:{type:"enemy",index:2,number:1,chaser:!0},15:{type:"box",content:"weapon"},16:{type:"enemy",index:0,number:2,chaser:!0},19:{type:"enemy",index:0,number:1,chaser:!1},25:{type:"enemy",index:1,number:2,chaser:!1},27:{type:"enemy",index:0,number:2,chaser:!0},28:{type:"box",content:"shield"},31:{type:"enemy",index:2,number:1,chaser:!0},32:{type:"enemy",index:0,number:1,chaser:!1},36:{type:"enemy",index:0,number:2,chaser:!0},41:{type:"enemy",index:2,number:2,chaser:!1},43:{type:"enemy",index:0,number:1,chaser:!0},46:{type:"enemy",index:0,number:1,chaser:!1},50:{type:"enemy",index:1,number:2,chaser:!1},55:{type:"enemy",index:0,number:1,chaser:!0},59:{type:"enemy",index:0,number:1,chaser:!0},60:{type:"enemy",index:0,number:1,chaser:!1},75:{type:"endStage"}},{6:{type:"enemy",index:0,number:3,chaser:!0},10:{type:"enemy",index:2,number:1,chaser:!0},14:{type:"enemy",index:1,number:1,chaser:!0},15:{type:"enemy",index:0,number:1,chaser:!1},17:{type:"box",content:"weapon"},23:{type:"enemy",index:1,number:2,chaser:!0},27:{type:"enemy",index:2,number:1,chaser:!1},28:{type:"box",content:"shield"},29:{type:"enemy",index:1,number:2,chaser:!0},34:{type:"enemy",index:0,number:2,chaser:!1},36:{type:"enemy",index:0,number:1,chaser:!0},41:{type:"enemy",index:2,number:2,chaser:!1},43:{type:"box",content:"weapon"},47:{type:"enemy",index:1,number:1,chaser:!1},56:{type:"enemy",index:2,number:3,chaser:!1},60:{type:"enemy",index:1,number:1,chaser:!0}}];class y extends EventTarget{constructor(e,t){super(),this.setVars(e,t)}setVars(e,{asset:t,w:s,h:i,x:h,y:n,speedX:a,speedY:o,dmg:r,owner:d}){this.ctx=e,this.asset=t,this.w=SI_GAME.data.w*s,this.h=SI_GAME.data.h*i,this.x=h,this.y=n,this.speedX=a,this.speedY=o,this.dmg=r,this.owner=d}draw(){this.ctx.beginPath(),this.ctx.drawImage(this.asset,this.x,this.y,this.w,this.h),this.ctx.closePath(),this.update()}update(){if(this.x+=this.speedX,this.y+=this.speedY,this.x>SI_GAME.data.w||this.x+this.w<0||this.y>SI_GAME.data.h||this.y+this.h<0){let e=new Event("remove");this.dispatchEvent(e)}}}var w=y;class x extends EventTarget{constructor(e,t,s){super(),this.setVars(e,t,s),this.addWeapon(SI_GAME.weapons[0]),this.setListeners()}setVars(e,t,{asset:s,speed:i,shield:h}){this.ctx=e,this.GameEngine=t,this.asset=s,this.speed=i,this.shield=h,this.w=.08*SI_GAME.data.w,this.h=.05*SI_GAME.data.h,this.x=10,this.y=SI_GAME.data.h/2,this.moveRight=!1,this.moveLeft=!1,this.moveUp=!1,this.moveDown=!1,this.reload=!1,this.weapons=[],this.eqWeapon=null,this.isGameOver=!1}setListeners(){SI_GAME.data.isMobile?(this.clickHandler=this.clickHandler.bind(this),document.addEventListener("click",this.clickHandler),this.swipesHandler=this.swipesHandler.bind(this),document.addEventListener("touchmove",this.swipesHandler),this.touchStartHandler=this.touchStartHandler.bind(this),document.addEventListener("touchstart",this.touchStartHandler),this.touchEndHandler=this.touchEndHandler.bind(this),document.addEventListener("touchend",this.touchEndHandler)):(this.keyDownHandler=this.keyDownHandler.bind(this),document.addEventListener("keydown",this.keyDownHandler),this.keyUpHandler=this.keyUpHandler.bind(this),document.addEventListener("keyup",this.keyUpHandler))}removeListeners(){SI_GAME.data.isMobile?(document.removeEventListener("click",this.clickHandler),document.removeEventListener("touchmove",this.swipesHandler),document.removeEventListener("touchstart",this.touchStartHandler),document.removeEventListener("touchend",this.touchEndHandler)):(document.removeEventListener("keydown",this.keyDownHandler),document.removeEventListener("keyup",this.keyUpHandler))}clickHandler(){this.GameEngine.playState&&(2*e.clientY>SI_GAME.data.h?this.switchWeapon():this.shot())}swipesHandler(e){if(!this.GameEngine.playState)return;let t=e.touches[0];t.clientX>this.touchX&&(this.moveRight=!0),t.clientX<this.touchX&&(this.moveLeft=!0),t.clientY<this.touchY&&(this.moveUp=!0),t.clientY>this.touchY&&(this.moveDown=!0),e.touches.length>1&&this.shot(),this.touchX=t.clientX,this.touchY=t.clientY}touchStartHandler(){this.GameEngine.playState&&(this.touchX=this.x,this.touchY=this.y)}touchEndHandler(){this.GameEngine.playState&&(this.moveUp=this.moveDown=this.moveRight=this.moveLeft=!1)}keyDownHandler(e){this.GameEngine.playState&&(("Right"==e.key||"ArrowRight"==e.key)&&(this.moveRight=!0),("Left"==e.key||"ArrowLeft"==e.key)&&(this.moveLeft=!0),("Up"==e.key||"ArrowUp"==e.key)&&(this.moveUp=!0),("Down"==e.key||"ArrowDown"==e.key)&&(this.moveDown=!0)," "===e.key&&this.shot(),("c"===e.key||"C"===e.key)&&this.switchWeapon())}keyUpHandler(e){this.GameEngine.playState&&(("Right"==e.key||"ArrowRight"==e.key)&&(this.moveRight=!1),("Left"==e.key||"ArrowLeft"==e.key)&&(this.moveLeft=!1),("Up"==e.key||"ArrowUp"==e.key)&&(this.moveUp=!1),("Down"==e.key||"ArrowDown"==e.key)&&(this.moveDown=!1))}addWeapon(e){const t={...e};let s,i=!1;for(const[e,h]of this.weapons.entries())if(h.name===t.name){i=!0,s=e;break}i?this.weapons[s].charges+=t.charges:(this.weapons.push(t),this.eqWeapon=t)}switchWeapon(){let e=this.weapons.indexOf(this.eqWeapon),t=e===this.weapons.length-1?0:e+1;this.eqWeapon=this.weapons[t]}draw(){this.ctx.beginPath(),this.ctx.drawImage(this.asset,this.x,this.y,this.w,this.h),this.ctx.closePath(),this.update()}update(){this.shield<=0&&!this.isGameOver&&this.shipExplosion(),this.moveRight&&this.x+this.w<SI_GAME.data.w&&(this.x+=this.speed),this.moveLeft&&this.x>0&&(this.x-=this.speed),this.moveDown&&this.y+this.h<SI_GAME.data.h&&(this.y+=this.speed),this.moveUp&&this.y>0&&(this.y-=this.speed),SI_GAME.data.isMobile&&(this.moveUp=this.moveDown=this.moveRight=this.moveLeft=!1)}shipExplosion(){this.isGameOver=!0;const e=new Event("explosion"),t={};t.x=this.x,t.y=this.y,t.w=this.w,t.h=this.h,t.speedX=0,t.speedY=0,t.time=60,e.explosionData=t,this.dispatchEvent(e)}shot(){if(this.reload||0===this.eqWeapon.charges)return;const e=new Event("shot"),t={};t.asset=this.eqWeapon.asset,t.w=this.eqWeapon.w,t.h=this.eqWeapon.h,t.x=this.x+this.w,t.y=this.y+Math.round(this.h/2)-Math.round(this.eqWeapon.h*SI_GAME.data.h/2),t.speedX=this.eqWeapon.speedX,t.speedY=this.eqWeapon.speedY,t.dmg=this.eqWeapon.damage,t.owner="p1",e.missleData=t,this.dispatchEvent(e),"UNLIMITED"!==this.eqWeapon.charges&&this.eqWeapon.charges--,this.reload=!0,setTimeout(()=>this.reload=!1,this.eqWeapon.reloadTime)}}var v=x;var g=class{constructor(e){this.setVars(e)}setVars(e){this.ctx=e,this.x=0,this.y=SI_GAME.data.h,this.w=SI_GAME.data.w,this.h=SI_GAME.data.statusBarHeight,this.scoreX=30,this.scoreY=SI_GAME.data.h+25,this.shieldX=30,this.shieldY=SI_GAME.data.h+45,this.weaponX=240,this.weaponY=SI_GAME.data.h+40,this.scoreIcon=SI_GAME.assets.scoreIcon,this.scoreIconX=this.scoreX-15,this.scoreIconY=this.scoreY-10,this.scoreIconSize=10,this.shieldIcon=SI_GAME.assets.shieldIcon,this.shieldIconX=this.shieldX-15,this.shieldIconY=this.shieldY-10,this.shieldIconSize=10,this.weaponIcon=SI_GAME.assets.weaponIcon,this.weaponIconX=this.weaponX-25,this.weaponIconY=this.weaponY-18,this.weaponIconSize=20}draw(e,t,{name:s,charges:i}){this.ctx.beginPath(),this.ctx.fillStyle="#773819",this.ctx.fillRect(this.x,this.y,this.w,this.h),this.ctx.strokeStyle="#21636c",this.ctx.lineWidth=4,this.ctx.strokeRect(this.x,this.y+2,this.w,this.h),this.ctx.font="18px Arial",this.ctx.fillStyle="#FFFFFF",this.ctx.fillText(`Score: ${e}`,this.scoreX,this.scoreY),this.ctx.fillText(`Shield: ${Math.max(0,t)}%`,this.shieldX,this.shieldY),this.ctx.font="24px Arial",this.ctx.fillText(`Weapon: ${s} (${i} charges)`,this.weaponX,this.weaponY),this.ctx.drawImage(this.scoreIcon,this.scoreIconX,this.scoreIconY,this.scoreIconSize,this.scoreIconSize),this.ctx.drawImage(this.shieldIcon,this.shieldIconX,this.shieldIconY,this.shieldIconSize,this.shieldIconSize),this.ctx.drawImage(this.weaponIcon,this.weaponIconX,this.weaponIconY,this.weaponIconSize,this.weaponIconSize),this.ctx.closePath()}};var E=class{constructor(){this.setVars(),this.setListeners()}setVars(){this.ctx=SI_GAME.data.ctx,this.bg=new d(this.ctx,SI_GAME.objects.background),this.ship=new v(this.ctx,this,SI_GAME.objects.playerShip),this.statusBar=new g(this.ctx),this.aliens=[],this.explosions=[],this.missles=[],this.boxes=[],this.playState=!1,this.timerInterval=null,this.timer=0,this.score=0,this.stage=0}setListeners(){this.handleShot=this.handleShot.bind(this),this.ship.addEventListener("shot",this.handleShot),this.handlePlayerExplosion=this.handlePlayerExplosion.bind(this),this.ship.addEventListener("explosion",this.handlePlayerExplosion)}newGame(){this.timerInterval&&this.reset(),this.play(u[this.stage]),this.drawFrame()}play(e){this.playState=!0,this.timerInterval=setInterval(()=>{if(this.playState){if(e[this.timer])switch(e[this.timer].type){case"enemy":const{index:t,number:s,chaser:i}=e[this.timer];for(let e=0;e<s;e++){let e=new r(this.ctx,SI_GAME.objects.alienShips[t],this.ship,i);e.addEventListener("shot",this.handleShot.bind(this)),e.addEventListener("explosion",this.handleAlienExplosion.bind(this)),e.addEventListener("remove",e=>this.aliens.splice(this.aliens.indexOf(e.target),1)),this.aliens.push(e)}break;case"box":const{content:h}=e[this.timer];let n=new c(this.ctx,SI_GAME.objects[h]);n.addEventListener("remove",e=>this.boxes.splice(this.boxes.indexOf(e.target),1)),this.boxes.push(n);break;case"endStage":this.setNextStage()}this.timer++}},1e3)}pause(){this.playState=!1}resume(){this.playState=!0,this.drawFrame()}reset(){clearInterval(this.timerInterval),this.ship.removeListeners(),this.setVars(),this.setListeners()}setNextStage(){this.stage++,clearInterval(this.timerInterval),this.timer=0,this.play(u[this.stage])}drawFrame(){this.ctx.clearRect(0,0,SI_GAME.data.w,SI_GAME.data.h),this.bg.draw(),this.ship.draw(),this.missles.forEach(e=>e.draw()),this.aliens.forEach(e=>e.draw()),this.explosions.forEach(e=>e.draw()),this.boxes.forEach(e=>e.draw()),this.statusBar.draw(this.score,this.ship.shield,this.ship.eqWeapon),this.detectCollisions(),this.playState&&requestAnimationFrame(()=>this.drawFrame())}handleShot(e){let t=new w(this.ctx,e.missleData);this.missles.push(t);let s=e=>{this.missles.splice(this.missles.indexOf(t),1),t.removeEventListener("remove",s)};t.addEventListener("remove",s)}handlePlayerExplosion(e){console.log("go"),this.addExplosion(e.explosionData)}handleAlienExplosion(e){this.addExplosion(e.explosionData),this.aliens.splice(this.aliens.indexOf(e.target),1),this.score+=e.target.reward}handleMissleExplosion(e,t){const s={};s.x="npc"===e.owner?e.x:e.x+e.w,s.y=Math.min(t.y+t.h-e.h/2,Math.max(e.y,t.y-e.h/2)),s.w=e.h,s.h=e.h,s.speedX=e.speedX/5,s.speedY=e.speedY/5,s.time=10,this.addExplosion(s)}addExplosion(e){let t=new m(this.ctx,e);t.addEventListener("remove",e=>this.explosions.splice(this.explosions.indexOf(e.target),1)),this.explosions.push(t)}detectCollisions(){this.missles.forEach((e,t)=>{"npc"===e.owner&&e.x<this.ship.x+this.ship.w&&e.x+e.w>this.ship.x&&e.y<this.ship.y+this.ship.h&&e.y+e.h>this.ship.y?(this.ship.shield-=e.dmg,this.handleMissleExplosion(e,this.ship),this.missles.splice(t,1)):"p1"===e.owner&&this.aliens.forEach((s,i)=>{e.x+e.w>s.x&&e.x<s.x+s.w&&e.y+e.h>s.y&&e.y<s.y+s.h&&(s.shield-=e.dmg,this.handleMissleExplosion(e,s),this.missles.splice(t,1))})}),this.boxes.forEach((e,t)=>{e.x<this.ship.x+this.ship.w&&e.x+e.h>this.ship.x&&e.y<this.ship.y+this.ship.h&&e.y+e.h>this.ship.y&&("shield"===e.type&&(this.ship.shield=Math.min(this.ship.shield+e.content.shield,100)),"weapon"===e.type&&this.ship.addWeapon(e.content.weapon),this.boxes.splice(t,1))})}};var f=class{constructor(e){this.setVars(e),this.setListeners(),this.runGame()}setVars(e){this.gameContainer=document.querySelector("main"),this.overlay=document.querySelector(".init-overlay"),this.overlayText=document.querySelector(".init-overlay__text"),this.menu=document.querySelector(".menu"),this.newGameBtn=document.querySelector(".menu__new-game"),this.resumeBtn=document.querySelector(".menu__resume"),this.menuItems=document.querySelectorAll(".menu li"),this.isMobile=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),this.isOverlayRemoved=!1,this.assets=e,this.game=null}setListeners(){this.newGameBtn.addEventListener("click",this.newGameHandler.bind(this)),this.resumeBtn.addEventListener("click",this.resumeHandler.bind(this)),document.addEventListener("keydown",this.menuKeydownHandler.bind(this));const e=this.isMobile?"click":"keydown";this.removeOverlay=this.removeOverlay.bind(this),document.addEventListener(e,this.removeOverlay),this.gameContainer.addEventListener("fullscreenchange",this.fullScreenHandler.bind(this))}runGame(){window.SI_GAME={},SI_GAME.isMobile=this.isMobile,SI_GAME.assets=this.assets,SI_GAME.data=h(),SI_GAME.objects=n(this.assets),SI_GAME.weapons=a(this.assets),this.game=new E,this.overlayText.textContent=this.isMobile?"Touch the screen to continue":"Press any key to continue"}removeOverlay(e){const t=this.isMobile?"click":"keydown";this.isMobile&&this.gameContainer.requestFullscreen(),this.overlay.style.display="none",this.isOverlayRemoved=!0,document.removeEventListener(t,this.rmoveOverlay)}newGameHandler(){this.game.newGame(),this.menu.classList.toggle("open")}resumeHandler(){this.game.timerInterval&&(this.isMobile&&this.gameContainer.requestFullscreen(),this.game.resume(),this.menu.classList.toggle("open"))}menuKeydownHandler(e){this.isOverlayRemoved&&(27===e.keyCode&&this.pauseHandler(),(38===e.keyCode||40===e.keyCode)&&this.menu.classList.contains("open")&&this.switchMenuItem(e),13===e.keyCode&&this.menu.classList.contains("open")&&this.selectMenuItem())}pauseHandler(){this.game.playState?this.game.pause():this.game.resume(),this.menu.classList.toggle("open"),this.menuItems.forEach(e=>e.classList.remove("selected")),this.resumeBtn.classList.add("selected")}switchMenuItem(e){let t,s=Array.prototype.indexOf.call(this.menuItems,document.querySelector(".selected"));38===e.keyCode&&s--,40===e.keyCode&&s++,t=s<0?this.menuItems.length-1:s>this.menuItems.length-1?0:s,this.menuItems.forEach(e=>e.classList.remove("selected")),this.menuItems[t].classList.add("selected")}selectMenuItem(){document.querySelector(".selected").click()}async fullScreenHandler(e){if(null!==document.fullscreenElement)try{await screen.orientation.lock("landscape")}catch(e){console.log(e.message)}else this.game.pause(),this.menu.classList.add("open")}};(function(e){return new Promise((t,s)=>{let i=Object.keys(e).length;const h={};for(let s in e)h[s]=new Image,h[s].onload=()=>{i--,0===i&&t(h)},h[s].src=e[s]})})({bg:"./assets/bg.png",ship:"./assets/ship.png",missle1:"./assets/missle1.png",missle2:"./assets/missle2.png",alien1:"./assets/ship_a1.png",alien2:"./assets/ship_a2.png",alien3:"./assets/ship_a3.png",missleA1:"./assets/missle_a1.png",missleA2:"./assets/missle_a2.png",missleA3:"./assets/missle_a3.png",explosion:"./assets/explo.png",shield:"./assets/shieldbox.png",weapon:"./assets/weaponbox.png",scoreIcon:"./assets/score-icon.png",shieldIcon:"./assets/shield-icon.png",weaponIcon:"./assets/weapon-icon.png"}).then(e=>new f(e))}]);