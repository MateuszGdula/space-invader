!function(s){var t={};function e(i){if(t[i])return t[i].exports;var h=t[i]={i:i,l:!1,exports:{}};return s[i].call(h.exports,h,h.exports,e),h.l=!0,h.exports}e.m=s,e.c=t,e.d=function(s,t,i){e.o(s,t)||Object.defineProperty(s,t,{enumerable:!0,get:i})},e.r=function(s){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},e.t=function(s,t){if(1&t&&(s=e(s)),8&t)return s;if(4&t&&"object"==typeof s&&s&&s.__esModule)return s;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:s}),2&t&&"string"!=typeof s)for(var h in s)e.d(i,h,function(t){return s[t]}.bind(null,h));return i},e.n=function(s){var t=s&&s.__esModule?function(){return s.default}:function(){return s};return e.d(t,"a",t),t},e.o=function(s,t){return Object.prototype.hasOwnProperty.call(s,t)},e.p="",e(e.s=0)}([function(s,t,e){"use strict";e.r(t);let i=document.querySelector(".game");const h={ctx:i.getContext("2d"),w:i.width,h:i.height};var a=class{constructor(s,{asset:t,speed:e}){this.ctx=s,this.asset=t,this.speed=e,this.x=0}draw(){this.ctx.beginPath(),this.ctx.drawImage(this.asset,this.x,0),this.ctx.drawImage(this.asset,this.x+SI_GAME.data.w,0),this.ctx.closePath(),this.x>-1*SI_GAME.data.w?this.x-=this.speed:this.x=0}};class n extends EventTarget{constructor(s,t){super(),this.setVars(s,t),this.addWeapon(SI_GAME.weapons[0]),this.setListeners()}setVars(s,{asset:t,speed:e,health:i}){this.ctx=s,this.asset=t,this.speed=e,this.health=i,this.x=10,this.y=SI_GAME.data.h/2,this.w=100,this.h=33,this.rightPressed=!1,this.leftPressed=!1,this.upPressed=!1,this.downPressed=!1,this.reload=!1,this.weapons=[],this.eqWeapon=null}setListeners(){this.keyDownHandler=this.keyDownHandler.bind(this),document.addEventListener("keydown",this.keyDownHandler),this.keyUpHandler=this.keyUpHandler.bind(this),document.addEventListener("keyup",this.keyUpHandler),console.log(this.eqWeapon===SI_GAME.objects.weapons[0])}keyDownHandler(s){("Right"==s.key||"ArrowRight"==s.key)&&(this.rightPressed=!0),("Left"==s.key||"ArrowLeft"==s.key)&&(this.leftPressed=!0),("Up"==s.key||"ArrowUp"==s.key)&&(this.upPressed=!0),("Down"==s.key||"ArrowDown"==s.key)&&(this.downPressed=!0)," "===s.key&&this.shot()}keyUpHandler(s){("Right"==s.key||"ArrowRight"==s.key)&&(this.rightPressed=!1),("Left"==s.key||"ArrowLeft"==s.key)&&(this.leftPressed=!1),("Up"==s.key||"ArrowUp"==s.key)&&(this.upPressed=!1),("Down"==s.key||"ArrowDown"==s.key)&&(this.downPressed=!1)}addWeapon(s){const t={...s};this.weapons.push(t),this.eqWeapon=t}draw(){this.ctx.beginPath(),this.ctx.drawImage(this.asset,this.x,this.y,this.w,this.h),this.ctx.closePath(),this.update()}update(){this.rightPressed&&this.x+this.w<SI_GAME.data.w&&(this.x+=this.speed),this.leftPressed&&this.x>0&&(this.x-=this.speed),this.downPressed&&this.y+this.h<SI_GAME.data.h&&(this.y+=this.speed),this.upPressed&&this.y>0&&(this.y-=this.speed),this.health<=0&&console.log("boom")}shot(){if(this.reload)return;let s=new Event("shot");s.x=this.x+this.w,s.y=this.y+Math.round(this.h/2),s.asset=this.eqWeapon.asset,s.speed=this.eqWeapon.speed,s.dmg=this.eqWeapon.damage,s.owner="p1",this.dispatchEvent(s),this.reload=!0,setTimeout(()=>this.reload=!1,100)}}var r=n;class o extends EventTarget{constructor(s,t,e,i,h,a,n){super(),this.setVars(s,t,e,i,h,a,n)}setVars(s,t,e,i,h,a,n){this.ctx=s,this.img=t,this.x=e,this.y=i,this.speed=h,this.dmg=a,this.owner=n,this.w=13,this.h=5}draw(){this.ctx.beginPath(),this.ctx.drawImage(this.img,this.x,this.y),this.ctx.closePath(),this.update()}update(){if(this.x+=this.speed,this.x+this.w>SI_GAME.data.w||this.x<0||this.y+this.h>SI_GAME.data.h||this.y<0){let s=new Event("remove");this.dispatchEvent(s)}}}var d=o;class l extends EventTarget{constructor(s,t,e){super(),this.setVars(s,t,e)}setVars(s,{asset:t,speed:e,health:i},h){this.ctx=s,this.asset=t,this.speed=e,this.health=i,this.x=SI_GAME.data.w,this.y=SI_GAME.data.h/2,this.w=100,this.h=33,this.reload=!1,this.target=h,this.alpha=1,this.weapon={asset:SI_GAME.assets.missle_a1,damage:20,speed:3}}draw(){this.ctx.beginPath(),this.ctx.globalAlpha=this.alpha,this.ctx.drawImage(this.asset,this.x,this.y,this.w,this.h),this.ctx.closePath(),this.ctx.globalAlpha=1,this.update()}update(){this.health<=0&&this.shipExplosion(),this.x-=this.speed,this.target.y+this.target.h/2>this.y+this.h/2?this.y+=this.speed/2:this.y-=this.speed/2,this.target.y<this.y+this.h/2&&this.target.y+this.target.h>this.y+this.h/2&&this.target.x+this.target.w<this.x&&this.shot()}shipExplosion(){this.asset=SI_GAME.assets.explosion,this.w+=2.4,this.h+=.8,this.alpha-=.03,this.alpha<=0&&this.dispatchEvent(new Event("explosion"))}shot(){if(this.reload)return;let s=new Event("shot");s.x=this.x,s.y=this.y+Math.round(this.h/2),s.asset=this.weapon.asset,s.speed=-1*this.weapon.speed,s.dmg=this.weapon.damage,s.owner="npc",this.dispatchEvent(s),this.reload=!0,setTimeout(()=>this.reload=!1,1e3)}}var p=l;var c=class{constructor(){this.setVars(),this.setListeners(),this.start()}setVars(){this.ctx=SI_GAME.data.ctx,this.bg=new a(this.ctx,SI_GAME.objects.background),this.ship=new r(this.ctx,SI_GAME.objects.playerShip),this.aliens=[],this.missles=[]}setListeners(){this.handleShot=this.handleShot.bind(this),this.ship.addEventListener("shot",this.handleShot)}start(){this.drawFrame();let s=new p(this.ctx,SI_GAME.objects.alienShips[0],this.ship);this.aliens.push(s),s.addEventListener("shot",this.handleShot.bind(this)),s.addEventListener("explosion",this.handleAlienExplosion.bind(this))}pause(){}stop(){}reset(){}drawFrame(){this.ctx.clearRect(0,0,SI_GAME.data.w,SI_GAME.data.h),this.bg.draw(),this.ship.draw(),this.missles.forEach(s=>s.draw()),this.aliens.forEach(s=>s.draw()),this.detectColisions(),requestAnimationFrame(()=>this.drawFrame())}handleShot(s){let t=new d(this.ctx,s.asset,s.x,s.y,s.speed,s.dmg,s.owner);this.missles.push(t);let e=s=>{this.missles.splice(this.missles.indexOf(t),1),t.removeEventListener("remove",e)};t.addEventListener("remove",e)}handlePlayerExplosion(s){}handleAlienExplosion(s){this.aliens.splice(this.aliens.indexOf(s.target),1)}detectColisions(){this.missles.forEach((s,t)=>{"npc"===s.owner&&s.x<this.ship.x+this.ship.w&&s.x>this.ship.x&&s.y<this.ship.y+this.ship.h&&s.y>this.ship.y?(this.ship.health-=s.dmg,this.missles.splice(t,1)):"p1"===s.owner&&this.aliens.forEach((e,i)=>{s.x+s.w>e.x&&s.x<e.x+e.w&&s.y+s.h>e.y&&s.y<e.y+e.h&&(e.health-=s.dmg,this.missles.splice(t,1))})})}};(function(s){return new Promise((t,e)=>{let i=Object.keys(s).length;const h={};for(let e in s)h[e]=new Image,h[e].onload=()=>{0===--i&&t(h)},h[e].src=s[e]})})({bg:"./assets/bg.png",ship:"./assets/ship.png",missle1:"./assets/missle1.png",alien1:"./assets/ship_a1.png",missle_a1:"./assets/missle_a1.png",explosion:"./assets/explo.png"}).then(s=>{window.SI_GAME={},SI_GAME.assets=s,SI_GAME.data=h,SI_GAME.objects=(s=>({background:{asset:s.bg,speed:.5},playerShip:{asset:s.ship,speed:2,health:100},alienShips:[{asset:s.alien1,speed:1.2,health:100}],weapons:[{name:"Blaster WTF-40",asset:s.missle1,damage:20,speed:4,reload:100,charges:-1},{name:"Blaster WTF-30",asset:s.missle1,damage:10,speed:3,reload:1e3}]}))(s),SI_GAME.weapons=(s=>[{name:"Blaster WTF-40",asset:s.missle1,damage:20,speed:4,reload:100,charges:-1},{name:"Blaster WTF-30",asset:s.missle1,damage:10,speed:3,reload:1e3}])(s),new c})}]);